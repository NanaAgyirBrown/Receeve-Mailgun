<h1 align="center">Welcome to Receeeve-Mailgun Challenge üëã</h1>
<p>
  <img alt="Version" src="https://img.shields.io/badge/version-1.0.0-blue.svg?cacheSeconds=2592000" />
  <a href="#" target="_blank">
    <img alt="License: MIT" src="https://img.shields.io/badge/License-MIT-yellow.svg" />
  </a>
  <a href="https://twitter.com/AgyirBrown" target="_blank">
    <img alt="" src="https://img.shields.io/twitter/follow/" />
  </a>
</p>

> This solution integrates mailgun webhooks into AWS lambda functions and also sends AWS SNS notifications after successfully saving the Payload sent from mailgun.

### ‚ú® [Demo](https://{your-aws-url}/{endpoint})

## Install Packages

```sh
npm i aws-sdk chalk morgan dotenv uuid
```

## Install Dev dependency
```sh
npm i nodemon -D
```
## Usage

```sh
npm run start
```
## Generating a public IP for your local host

```sh
ngrok.exe http {YOUR_PORT}
```

## APPLICATION SET UP

          * 1. CREATE AN AWS ACCOUNT
          * 2. CREATE A MAILGUN ACCOUNT AND RETRIEVE YOUR SIGNKEY - WHICH WOULD BE USED FOR VALIDATION THE AUTHENTICITY OF ALL E-MAIL EVENT PAYLOADS
          * 3. SET UP YOUR DEV TOOL - VSCODE OR ANY TOOL - WITH YOUR AWS CREDENTIALS TO ENABLE DIRECT UPLOADS

## ENDPOINTS
The solution upon successful upload would expose the following EndPoints
## BASEUrl https://{your-aws-url}/{stage}/ 
1. /setup  

          * ** _This endpoint when posted to, would set-up some environment variables needed by the application._**
          * Post /setup 
          * Body {Port:"", ARN: "", SIGNKEY: ""}
        
2. /response

           * _**This endpoint accepts 2 Methods with Parameters.**_
           * **GET /response**
              returns a list of saved Mailgun responses from the DB

           * **GET /response?id**
              returns a specific Mailgun responses from the DB based on the Id which is the primary key.

           * **GET /response?event**
              returns a list of saved Mailgun responses from the DB based on the _mailgun event type i.e. - DELIVERED, OPENED, CLICKED, UNSUBSCRIBED_.

           * **POST /response**
              this would save to the DB a mailgun payload and also trigger the notification endpoint to notify any subscribed listener. Reference mailgun 
              for a sample payload.

3. /subscribe

            * _**This endpoint for subscribing to an AWS Simple Notification Service (SNS).**_
            * **POST /subscribe**
            * {"Protocol":"", "Topic": "", "Endpoint":"" }

4. /notification

            * This endpoint recieves notifications from the SNS subscribed. 
            * This endpoint would be posted when everytime there is new mailgun Payload saved. 
            * N.B: - You wouldn't need to POST to this endpoint but for test purpose you can a sample payload below to test. 
            * POST /notification
            * {"timestamp":"", "type":"" } 
            * N.B: - "type" - most be a _mailgun event type i.e. - DELIVERED, OPENED, CLICKED, UNSUBSCRIBED_


## API RESPONSES

            * All endpoints would return the following StatusCodes:
            * 200 :- For successful and complete execution
            * 417 :- For correct payload but unreachable service or server
            * 400 :- For error prune execution with the specific error message attached to the http response
            * 500 :- For exceptions 

NOTE :- GRANT ALL NECESSARY AWSROLE POLICIES FOR YOUR LAMBDA FUNCTION. THE SOLUTION WOULD INITIALLY GRANT THE FOLLOWING PERMISSIONS 

	     * STORAGE_RECEEVECHALLDB_ARN
	     * STORAGE_RECEEVECHALLDB_NAME

## Author

üë§ **Alfred Nana Brown**

* Twitter: [@https://twitter.com/AgyirBrown](https://twitter.com/AgyirBrown)
* Github: [@https://github.com/NanaAgyirBrown](https://github.com/NanaAgyirBrown)
* LinkedIn: [@https://www.linkedin.com/in/alfred-nana-brown-a21b6a58/](https://www.linkedin.com/in/alfred-nana-brown-a21b6a58\/)

## Show your support

Give a ‚≠êÔ∏è if this project helped you!

***
_This README was generated with ‚ù§Ô∏è by [readme-md-generator](https://github.com/kefranabg/readme-md-generator)_

# Getting Started with Amplify CLI
This directory was generated by [Amplify CLI](https://docs.amplify.aws/cli).

Helpful resources:
- Amplify documentation: https://docs.amplify.aws
- Amplify CLI documentation: https://docs.amplify.aws/cli
- More details on this folder & generated files: https://docs.amplify.aws/cli/reference/files
- Join Amplify's community: https://amplify.aws/community/
